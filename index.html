<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>ููุชุฌุงุชูุง</title>
    <link rel="stylesheet" href="main.css" />
    <style></style>
  </head>
  <body>
    <!-- ุงููุงูุจุงุฑ -->
    <div class="navbar">
      <div class="logo">ุงุณู ุงููุนุตุฑู</div>
      <div class="nav-links">
        <a href="#">ุงููุงุชุณ</a>
        <a href="#">ุงูููุณ </a>
        <a href="#">ุงูุงุชุตุงู </a>
      </div>
    </div>

    <h2 class="all-products">ูู ุงูููุชุฌุงุช</h2>
    <div id="products"></div>

    <!-- ููุฎุต ุงูุทูุจ -->
    <div class="order-summary" id="orderSummary">
      <h3>ุงูุทูุจุงุช ุงููุฎุชุงุฑุฉ:</h3>
      <ul id="orderList"></ul>
      <p><strong>ุงูุฅุฌูุงูู:</strong> <span id="totalPrice">0</span> ุฌููู</p>
      <button class="confirm-btn" onclick="sendOrder()">ุชุฃููุฏ ุงูุทูุจ</button>
    </div>

    <!-- ูุงูุฐุฉ ุงูููุฑู -->
    <div id="formModal" class="modal" style="display: none">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">ร</button>
        <h3>ูุนูููุงุช ุงูุชูุตูู</h3>
        <input type="text" id="username" placeholder="ุงูุงุณู" />
        <input type="text" id="address" placeholder="ุงูุนููุงู ุจุงูุชูุตูู" />
        <input type="text" id="number" placeholder="ุฑูู ุงููุงุชู" />
        <button class="send-btn" onclick="sendToWhatsApp()">ุฅุฑุณุงู ุงูุทูุจ</button>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCSKBvATBOik2am510JJmoj2MYQszHy32Y",
        authDomain: "fayad-8f902.firebaseapp.com",
        projectId: "fayad-8f902",
        storageBucket: "fayad-8f902.appspot.com",
        messagingSenderId: "513233944816",
        appId: "1:513233944816:web:da524ebd1a7aac866d8235",
        measurementId: "G-V76JL0C0L1",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const container = document.getElementById("products");
      const orderList = document.getElementById("orderList");
      const orderSummary = document.getElementById("orderSummary");
      const totalPriceEl = document.getElementById("totalPrice");

      let orders = [];
      const buttonMap = new Map();

      async function loadProducts() {
        const querySnapshot = await getDocs(collection(db, "products"));
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const productDiv = document.createElement("div");
          productDiv.className = "box-color";
          productDiv.innerHTML = `
            <img src="${data.image}" alt="ููุชุฌ" />
            <h3>${data.name}</h3>
            <div class="options">
              <label>ุงูุนุฏุฏ: </label>
              <input type="number" min="1" value="${
                data.quantity || 1
              }" style="width: 50px;" class="qty-input" />
            </div>
            <div class="options">
              <label>ุงูุณุนุฑ: </label>
              <span class="price">${data.price}</span> ุฌููู
            </div>
            <button class="order-btn">ุงุทูุจ ุงูุขู</button>
          `;

          const orderBtn = productDiv.querySelector(".order-btn");
          const qtyInput = productDiv.querySelector(".qty-input");

          buttonMap.set(data.name, orderBtn);

          orderBtn.addEventListener("click", () => {
            const qty = parseInt(qtyInput.value);
            const price = parseFloat(data.price);
            const total = qty * price;

            orders.push({
              name: data.name,
              qty,
              price,
              total,
            });

            orderBtn.disabled = true;
            updateOrderList();
          });

          container.appendChild(productDiv);
        });
      }

      function updateOrderList() {
        orderList.innerHTML = "";
        let total = 0;
        orders.forEach((item, index) => {
          total += item.total;
          const li = document.createElement("li");
          li.innerHTML = `
            <button class="remove-btn" data-index="${index}">x</button>
            <strong>${item.name}</strong><br />
            ุนุฏุฏ ุงูุนูุงุตุฑ: ${item.qty}<br />
            ุงูุณุนุฑ: ${item.total} ุฌููู
          `;
          orderList.appendChild(li);

          // ุฒุฑ ุงูุญุฐู
          li.querySelector(".remove-btn").addEventListener("click", () => {
            const btn = buttonMap.get(item.name);
            if (btn) btn.disabled = false;

            orders.splice(index, 1);
            updateOrderList();
          });
        });

        totalPriceEl.textContent = total;
        orderSummary.style.display = orders.length > 0 ? "block" : "none";
      }

      window.sendOrder = function () {
        document.getElementById("formModal").style.display = "flex";
      };

      window.closeModal = function () {
        document.getElementById("formModal").style.display = "none";
      };

      window.sendToWhatsApp = function () {
        const name = document.getElementById("username").value.trim();
        const address = document.getElementById("address").value.trim();

        if (!name || !address) {
          alert("ูู ูุถูู ุงููุฃ ุงูุงุณู ูุงูุนููุงู.");
          return;
        }

        let msg = `๐ ุทูุจ ุฌุฏูุฏ:\n`;
        orders.forEach((item) => {
          msg += `- ${item.name}\nุนุฏุฏ: ${item.qty}\nุงูุณุนุฑ: ${item.total} ุฌููู\n\n`;
        });

        msg += `๐ค ุงูุงุณู: ${name}\n๐ ุงูุนููุงู: ${address}\n๐ฐ ุงูุฅุฌูุงูู: ${totalPriceEl.textContent} ุฌููู`;

        const phone = "201018078546";
        const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        window.open(url, "_blank");
      };

      document.addEventListener("DOMContentLoaded", loadProducts);
    </script>
  </body>
</html>
